# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=pwntools
pkgver=4.0.0
pkgrel=1
pkgdesc='CTF framework and exploit development library.'
arch=('any')
url='https://github.com/Gallopsled/pwntools'
license=('MIT' 'GPL2' 'BSD')
groups=('blackarch' 'blackarch-disassembler' 'blackarch-reversing')
depends=('python2' 'python2-paramiko' 'python2-mako' 'python2-pyelftools'
         'python2-capstone' 'python2-pyserial' 'python2-requests' 'python2-isort'
         'python2-pip' 'python2-tox' 'python2-pygments' 'python2-pysocks'
         'python2-dateutil' 'python2-psutil' 'python2-pypandoc' 'python2-sphinx'
         'python2-intervaltree' 'python2-pysqlite' 'python2-ropgadget'
         'python2-packaging' 'python2-sortedcontainers' 'python2-doc2dash'
         'python2-coveralls' 'python2-unicorn')
makedepends=('python2-setuptools')
source=("https://github.com/Gallopsled/pwntools/archive/$pkgver.tar.gz"
        'setup.py.patch')
install="$pkgname.install"
sha512sums=('23c566ff5682bea2e0bb0b6b39ff2d211e4cba5a47a6b7d1d9870eef5ffaaf8d37f2826106d7821ef3969de76b6e0e994bd3d27314c837d4be2e5702d0925852'
            '48f1412522879b3f46a3682f27bf8307b5c9fbe7063ab4c3219e8ec27458820d5df5cb7f47578f090a553aaf3749f9913706c5012e5631a8aea28bf6768f07d5')

prepare() {
  patch -p1 < setup.py.patch

  cd "$pkgname-$pkgver"

  sed -i 's|python2|python2|' pwnlib/elf/datatypes.py
}

build() {
  cd "$pkgname-$pkgver"

  python2 setup.py build
}

package() {
  cd "$pkgname-$pkgver"

  _tools="asm common constgrep checksec cyclic disasm errno elfdiff elfpatch"
  _tools="$_tools debug disablenx hex main phd pwn pwnstrip scramble shellcraft"
  _tools="$_tools unhex update template"

  install -Dm 644 LICENSE-pwntools.txt \
    "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

  python2 setup.py install --root="$pkgdir" --optimize=1

  for t in $_tools; do
    mv "$pkgdir/usr/bin/$t" "$pkgdir/usr/bin/$pkgname-$t"
  done
}

