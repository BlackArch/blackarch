# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=gvm-libs
pkgver=22.4.0
pkgrel=2
pkgdesc='This is the libraries module for the Greenbone Community Edition.'
arch=('x86_64')
groups=('blackarch' 'blackarch-scanner')
url='https://github.com/greenbone/'
license=('GPL')
depends=('libnet' 'libssh' 'hiredis' 'paho-mqtt-c'
  'doxygen')
makedepends=('git' 'cmake')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/greenbone/gvm-libs/archive/refs/tags/v$pkgver.tar.gz")
sha512sums=('607625a955720b37679c76053bbbaeb99e06832488a90e052c0315900f9cadc34616f2db3f8408d116354d80d30c71618e3c1bf51dcc7f5a80ddeb17b55ab850')

build() {
  cd "${pkgname}-${pkgver}"

  export INSTALL_PREFIX=/usr/local
  export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig

  cmake "-DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \
    -DSYSCONFDIR=/etc \
    -DLOCALSTATEDIR=/var \
    --debug-output ."

  make "-j$(nproc)"
}

package() {
  cd "${pkgname}-${pkgver}"

  make DESTDIR="$pkgdir" install
  install -Dm 644 -t "$pkgdir/usr/share/doc/$pkgname/" *.md
}

