# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=wapiti
pkgver=3.0.9.r11.g68099fe
pkgrel=4
groups=('blackarch' 'blackarch-webapp' 'blackarch-scanner' 'blackarch-fuzzer')
pkgdesc='A vulnerability scanner for web applications. It currently search vulnerabilities like XSS, SQL and XPath injections, file inclusions, command execution, LDAP injections, CRLF injections...'
url='https://github.com/wapiti-scanner/wapiti'
license=('GPL')
depends=('python' 'python-httpx' 'python-httpx-socks' 'python-beautifulsoup4'
         'python-tld' 'python-yaswfp' 'python-mako' 'python-pysocks'
         'python-markupsafe' 'python-six' 'python-importlib-metadata'
         'python-browser-cookie3' 'python-cryptography' 'python-sqlalchemy'
         'python-aiosqlite' 'python-loguru' 'python-dnspython'
         'python-httpcore' 'sslyze' 'python-humanize' 'python-keyring'
         'python-aiocache' 'python-brotli' 'python-brotlicffi'
         'python-async-timeout')
makedepends=('git' 'python-setuptools' 'python-wheel' 'python-pip')
arch=('any')
source=("git+https://github.com/wapiti-scanner/$pkgname.git")
sha512sums=('SKIP')

pkgver() {
  cd "$pkgname"

  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd $pkgname

  sed -ri 's/==/>=/g' setup.py
}

build() {
  cd "$pkgname"

  python setup.py build
}

package() {
  cd "$pkgname"

  python setup.py install --root="$pkgdir" --prefix=/usr -O1 --skip-build

  install -Dm 644 -t "$pkgdir/usr/share/doc/$pkgname/" README.rst INSTALL.md \
    VERSION doc/AUTHORS doc/ChangeLog* doc/*.md doc/*.txt doc/*.html doc/*.ico
}

