# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=sipvicious
pkgver=295.3646856
pkgrel=1
groups=('blackarch' 'blackarch-automation' 'blackarch-exploitation')
pkgdesc="Tools for auditing SIP devices"
arch=('any')
url='http://blog.sipvicious.org'
license=('GPL2')
depends=('python2')
source=('git+https://github.com/EnableSecurity/sipvicious.git')
conflicts=('sipvicious-svn')
sha512sums=('SKIP')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {
  cd "$pkgname"

  chmod 755 *.py
  sed -i "s:/usr/bin/env python:/usr/bin/env python2:" *.py

  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share"

  for _prog in svmap.py svwar.py svcrack.py svreport.py svcrash.py
  do
    ln -s "../share/sipvicious/$_prog" "$pkgdir/usr/bin/${_prog%%.*}"
  done

  mv "$srcdir/$pkgname" "$pkgdir/usr/share/$pkgname"
}

