# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=ropgadget2
_pkgname=ROPgadget
pkgver=5.8
pkgrel=1
pkgdesc='Search gadgets in binaries to facilitate ROP exploitation for several file formats and architectures'
groups=('blackarch' 'blackarch-exploitation')
url='http://www.shell-storm.org/project/ROPgadget'
arch=('any')
license=('GPL2')
depends=('python2-capstone')
makedepends=('python2-setuptools')
source=("https://github.com/JonathanSalwan/$_pkgname/archive/v$pkgver.tar.gz")
sha512sums=('03f8126019713b5c24a466b39c60921c22f8988d47654b6ec7a48ec22bdb1f51955daf13efaeaa16305d1adf3edd3aeba506086896e7b887153a0c39dd3212c3')

prepare() {
  cd "$_pkgname-$pkgver"

  sed 's|python2|python|g' -i ropgadget/**/*.py ropgadget/*/*/*.py
}

build() {
  cd "$_pkgname-$pkgver"

  python2 setup.py build
}

check() {
  cd "$_pkgname-$pkgver"

  ./ROPgadget.py --binary ./test-suite-binaries/elf-Linux-x86 --string "main"||:
}

package() {
  cd "$_pkgname-$pkgver"

  python2 setup.py install -O1 --root="$pkgdir" --prefix=/usr --skip-build

  install -Dm 644 README.md -t "$pkgdir/usr/share/doc/$pkgname"

  mv "$pkgdir/usr/bin/ROPgadget" "$pkgdir/usr/bin/ROPgadget2"
}

