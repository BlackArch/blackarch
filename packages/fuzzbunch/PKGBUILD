# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=fuzzbunch
pkgver=32.2b76c22
pkgrel=1
pkgdesc='NSA Exploit framework'
arch=('x86_64')
groups=('blackarch' 'blackarch-exploitation')
url='https://github.com/mdiazcl/fuzzbunch-debian'
license=('custom:unknown')
depends=('wine' 'winetricks')
makedepends=('git')
install='fuzzbunch.install'
source=("git+https://github.com/mdiazcl/$pkgname-debian.git"
        'fuzzbunch.desktop'
        'fuzzbunch.install'
        'path.reg')
sha512sums=('SKIP'
            'cb0516c5c568670f580d075e5368ec9a92cfae6c0481c1865cff5cabe0591069d75320f13e1d9fdd5fdfe8bf83dff82d94e2071039d9884b04f72b1c1f5ed195'
            '84e280f667b009caebcc712ed47139e04d4a63082d9eb65df961584749133b3668034cf1ff12ee14dd48286651fa410ac7c6a112b4a85648f470cebe91ff4846'
            '392092bedaa348964d68a68bf21756052d81666fdadc3c3488923ee69ac4a4cb3385174ae068170b4f568964ca1c9983fb6fce6abb6de0529b2a8160b3dd017b')

pkgver() {
  cd "$pkgname-debian"

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {
  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share/$pkgname/.wine-fuzzbunch/drive_c/"

  cp path.reg "$pkgdir/usr/share/$pkgname/.wine-fuzzbunch/path.reg"
  cp -a "$pkgname-debian" "$pkgdir/usr/share/$pkgname/.wine-fuzzbunch/drive_c"

  find "$pkgdir"/usr/share -type f -exec chmod 644 "{}" \;
  find "$pkgdir"/usr/share -type d -exec chmod 755 "{}" \;

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/bin/sh
export WINEPREFIX=/usr/share/$pkgname/.wine-fuzzbunch
cd /usr/share/$pkgname/.wine-fuzzbunch/drive_c/fuzzbunch-debian/windows
echo "run: python fb.py"
exec wine cmd.exe
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"

  # menu entry
  install -Dm644 "${srcdir}/${pkgname}.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"
}

