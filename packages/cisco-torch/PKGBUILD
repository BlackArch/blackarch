# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=cisco-torch
pkgver=11.917e6af
pkgrel=1
groups=('blackarch' 'blackarch-exploitation' 'blackarch-fingerprint' 'blackarch-scanner')
pkgdesc="Cisco Torch mass scanning, fingerprinting, and exploitation tool."
url="http://www.arhont.com"
license=('LGPL')
depends=('perl' 'perl-net-telnet' 'perl-net-snmp' 'perl-net-ssh-perl' 'perl-net-ssleay')
arch=('any')
#source=('git+https://github.com/foreni-packages/cisco-torch.git')
source=('git+https://github.com/foreni-packages/cisco-torch.git')
sha512sums=('SKIP')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {
  cd "cisco-torch-debian-1kali4"

  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share/$pkgname/"
  install -dm 755 "$pkgdir/usr/share/doc/$pkgname/"

  install -Dm 644 CHANGELOG.txt "$pkgdir/usr/share/doc/$pkgname/"
  install -Dm 644 README.txt "$pkgdir/usr/share/doc/$pkgname/"
  install -Dm 644 TODO "$pkgdir/usr/share/doc/$pkgname/"

  install -Dm 644 brutefile.txt "$pkgdir/usr/share/$pkgname/"
  install -Dm 644 community.txt "$pkgdir/usr/share/$pkgname/"
  install -Dm 644 torch.conf "$pkgdir/usr/share/$pkgname/"
  install -Dm 644 fingerprint.db "$pkgdir/usr/share/$pkgname/"

  for f in brutefile.txt community.txt fingerprint.db password.txt \
           tfingerprint.db torch.conf users.txt; do
    install -Dm 644 $f "$pkgdir/usr/share/$pkgname/"
  done

  install -Dm 755 cisco-torch.pl "$pkgdir/usr/share/$pkgname/"
  cp -r include "$pkgdir/usr/share/$pkgname/"
  cp -r tftproot $pkgdir/usr/share/$pkgname/

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/bin/sh
cd /usr/share/$pkgname/
export PERL5LIB="/usr/share/cisco-torch"
exec perl cisco-torch.pl "\${@}"
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"
}

