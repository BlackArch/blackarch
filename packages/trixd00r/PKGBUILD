# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=trixd00r
pkgver=81.2fbcbc0
pkgrel=1
groups=('blackarch' 'blackarch-backdoor')
pkgdesc='An advanced and invisible userland backdoor based on TCP/IP for UNIX systems.'
url='http://nullsecurity.net/tools/backdoor.html'
arch=('x86_64' 'armv6h' 'armv7h' 'aarch64')
license=('custom:unknown')
depends=('libpcap')
source=('git+https://github.com/nullsecuritynet/tools.git')
sha512sums=('SKIP')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd "$pkgname"

  sed -i 's/LDFLGAS_IRIX/LDFLAGS_IRIX/' Makefile
}

build() {
  cd "$pkgname"

  # We can't build the solaris client.
  # The client should be built for Linux so the 'linux' system must be last in the list.
  for sys in freebsd netbsd openbsd macos aix hpux irix linux ; do
    rm -rf $sys
    make MAKE=make $sys
    mkdir $sys
    mv trixd00rd trixd00rd-$sys
  done
}

package() {
  cd "$pkgname"

  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share/$pkgname"
  install -dm 755 "$pkgdir/usr/share/doc/$pkgname"

  install -m 755 trixd00rd-* "$pkgdir/usr/share/$pkgname/"
  install -m 755 trixd00r "$pkgdir/usr/bin"

  install -m 644 docs/* "$pkgdir/usr/share/doc/$pkgname"
}

