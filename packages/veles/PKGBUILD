# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=veles
pkgver=2018.05
pkgrel=1
epoch=3
pkgdesc='New open source tool for binary data analysis.'
url='https://codisec.com/veles/'
arch=('x86_64' 'aarch64')
groups=('blackarch' 'blackarch-binary' 'blackarch-reversing'
        'blackarch-disassembler')
license=('Apache-2.0')
depends=('qt5-base' 'python' 'python-pyopenssl' 'python-msgpack' 'python-six'
         'python-pbr' 'double-conversion')
makedepends=()
source=("https://github.com/codilime/veles/releases/download/${pkgver}.0.TIF/Veles_${pkgver}_64bit_Ubuntu1604.deb"
        'fix_qt5_use_modules.patch')
sha512sums=('4e441e1c19bda1053e2e33936598c634c18cd17f5d9948d1950b12a5d150367c4d55b443f48f83c6b56593e4eba9723d8bc97b206280c30698a24e806ff5e787'
            '421d2e782a25b88b21d5b47453c4e46fa22855db2a4364e6be9656f264191d6a6afbd7b60e354c4eb400bc71afe2f596a40c448498654e8e0ee43e9352848378')

package() {
  tar xvf data.tar.gz
  cp -r usr $pkgdir
  tar xfv "$pkgdir/usr/share/veles-server/"veles-*.tar.gz

  _pypath="$(find . -type f -name setup.py -print -quit)"

  pushd "$(dirname $_pypath)"

  python setup.py build

  python setup.py install --root="$pkgdir" --prefix=/usr -O1 --skip-build

  popd
}

