From: Arnaud Rebillout <arnaudr@kali.or>
Date: Wed, 20 Apr 2022 11:17:17 +0200
Subject: Update code to build against libndpi 3.x.

Last-Update: 2021-02-10
---
 dissectors/tcp_ca/tcp_analysis.c  | 2 +-
 dissectors/tcp_grbg/tcp_garbage.c | 2 +-
 dissectors/udp_ca/udp_analysis.c  | 2 +-
 dissectors/udp_grbg/udp_garbage.c | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/dissectors/tcp_ca/tcp_analysis.c b/dissectors/tcp_ca/tcp_analysis.c
index de0d453..b25ff41 100644
--- a/dissectors/tcp_ca/tcp_analysis.c
+++ b/dissectors/tcp_ca/tcp_analysis.c
@@ -1081,7 +1081,7 @@ int DissectInit(void)
     mkdir(tmp_dir, 0x01FF);
 
     /* ndpi */
-    ndpi = ndpi_init_detection_module();
+    ndpi = ndpi_init_detection_module(ndpi_no_prefs);
     if (ndpi == NULL) {
         LogPrintf(LV_ERROR, "nDPi initializzation failed");
 
diff --git a/dissectors/tcp_grbg/tcp_garbage.c b/dissectors/tcp_grbg/tcp_garbage.c
index 4797a7d..3281c22 100644
--- a/dissectors/tcp_grbg/tcp_garbage.c
+++ b/dissectors/tcp_grbg/tcp_garbage.c
@@ -1250,7 +1250,7 @@ int DissectInit(void)
 
     /* ndpi */
     pthread_mutex_init(&ndpi_mux, NULL);
-    ndpi = ndpi_init_detection_module();
+    ndpi = ndpi_init_detection_module(ndpi_no_prefs);
     if (ndpi == NULL) {
         LogPrintf(LV_ERROR, "nDPi initializzation failed");
 
diff --git a/dissectors/udp_ca/udp_analysis.c b/dissectors/udp_ca/udp_analysis.c
index d98f113..02fb092 100644
--- a/dissectors/udp_ca/udp_analysis.c
+++ b/dissectors/udp_ca/udp_analysis.c
@@ -631,7 +631,7 @@ int DissectInit(void)
 
     /* ndpi */
     pthread_mutex_init(&ndpi_mux, NULL);
-    ndpi = ndpi_init_detection_module();
+    ndpi = ndpi_init_detection_module(ndpi_no_prefs);
     if (ndpi == NULL) {
         LogPrintf(LV_ERROR, "nDPi initializzation failed");
 
diff --git a/dissectors/udp_grbg/udp_garbage.c b/dissectors/udp_grbg/udp_garbage.c
index 1acf1cc..30d2f95 100644
--- a/dissectors/udp_grbg/udp_garbage.c
+++ b/dissectors/udp_grbg/udp_garbage.c
@@ -569,7 +569,7 @@ int DissectInit(void)
 
     /* ndpi */
     pthread_mutex_init(&ndpi_mux, NULL);
-    ndpi = ndpi_init_detection_module();
+    ndpi = ndpi_init_detection_module(ndpi_no_prefs);
     if (ndpi == NULL) {
         LogPrintf(LV_ERROR, "nDPi initializzation failed");
 
