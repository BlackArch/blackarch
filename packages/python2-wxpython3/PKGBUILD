# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.
#
# $Id: PKGBUILD 314848 2018-04-07 14:39:43Z bgyorgy $
# Old Maintainer: Eric BÃ©langer <eric@archlinux.org>

pkgname=python2-wxpython3
_pkgname=wxPython
pkgver=3.0.2.0
pkgrel=4
pkgdesc='Classic wxWidgets GUI toolkit for Python.'
arch=('x86_64' 'aarch64')
license=('custom:wxWindows')
url="https://www.wxpython.org"
depends=('wxgtk3' 'python2')
makedepends=('mesa' 'glu')
conflicts=(wxpython)
replaces=(wxpython)
provides=("wxpython=$pkgver")
source=("https://downloads.sourceforge.net/wxpython/wxPython-src-$pkgver.tar.bz2"
        'fix-plot.patch')
sha512sums=('a3798e89ff19344253aac7d771971e519f7fa9723e82bd97e98f16fd7f1572e513170b02295b872dae0b1ae3fa95efc4ef34d078045b839694b4fdad3a27c9e4'
            '6b4d235bbc67be66ae32c45b9ae8d2fd1aa6513d8625e1fa8af8f8399183ab598bd34ccd65158e113e8b99b86f3fd566e264d9bdeb681e68d634de17be29c473'
            '77fdf40dcbda6e4cf5c859af2930e79aad0c924c5b585f0341ec5f4a5826cd28ebf08303346d55a0e9bd300666fb8b7781fafb1bbcd0a0ca34d7f067fd46e1a4'
            '52f09410051c992e7256213501a9568cb8ab316fc36233ba8d6d8ee51b76d8bd4983b8a7a7c859f674851b8a87d5a49e647ee4614ef48b01d37bb543b9ace08f'
            '7eed8d5f9e97cab959475e8f7c226d8b62777bf5993762ec455ab74b3cb771e72c80dd6c4860f15d7275a6348f8dd6d19a22165d8d5bfeccdec858df5a155875'
            'fb1f41028bdfb1157f85372230f52fe922cc9e4bb7ef37b36b30b438d784fccf0b8a9ec4197cd84fd6195c43669f70e076348a399314a95cbac3eddf05375436'
            'b70434b02c0b299751dd31f52d4f0146db2472a0be1c617d9ce3814b6ddb26ca9a66981dbb819643c8f29cfd612bb8a0b841e0a601af00a931590607fc6ca73a'
            'efd031aa3ff60052df8237846b58b0ce04ad279780fe27b7108eab736681e8257972da5bb90a4848e1a4892dad49e4bbf4ee220c1f1c6da57640855c96ef3f27'
            'fea24e7928db31aa7d7f6a9f29cdea97e1ccb1951a18c1c0c396ff748f221b52d4909b7e2204b1a41dfd15c35a383ecaef15ee837c54712bfd6f8cb59a51c2d8'
            'f169a0dcd657db9bcf8a9724510b395db69d326002de76c4f8f59669d0cb4aa0de34014e625030ae263074bd2a620405e8870e6086e39b8f8ff7c7742ad2f924'
            '9bf694f7fcd4cc5db0d7414118005ca4b17f060d4b46636168aa20d2cc31842a0bb1c9621516b5ba7f9a035d0181b4c5473ad57469bb811008a4f1425566f29d'
            '3f3c458637ec228b08924793428b18da14e01a6d15273d97bad11abe761015b7fbf7a6233fc18367b8d41402fb3f89230ce351049ec7c27e2394980f41e4c9bd'
            'f378eec1a44d7efbdaf80e4aeed083c54b09fc49623b46830e4c7832aa25184eb3fa9c54a25cc729177730eb68d5c5f28982797a25e20a34a57cb73dc23cff34'
            'c1dd311b741be11f3d2e4a48f7d95b7014c8992ad6112aad316dafbb422dd85fc48f3ae5d620df59fc6e8f0d81d0c78d5bb8366a7fc5b4e266ebf6b2c2c620a1'
            '17d0faeec8ef1790f20e82c52b3620fb2f0791e1a5c70053d754ddf5a5bbd22d1a238ed9050362f38d76146ca9b312a796c746abee8275bd8d4833739b32c3ae'
            'be7d26a44cbd959bcc93cde24b5fad110a9ced12b6aee4a1ef458356d2198f1bd2b86c41d000f47cec50c58f4a8dc9c18b59a079c591696f97a4744969c532e4'
            '2d3e9347d39a18b0d8f29190369690990f39a86b8900a358fd2c73d8ed5b05a6c63b3021d17de448ad5720a300f2d85a23a917c842fe97f745b60cc6c797fe29'
            '57607cfde8aae5e6c19fc3e9fcb133c3d818be6bb8e3e41002e2d080ce82e50a377d8553f691a8d94b23fbb49a82700792152ce0e0ba3d973ca10194ab615aff'
            '1c82a392c1c03990e488aa332e3fe45d7166dc8d1b33c2ded47681bada23a681a21cda0ee8798f0302aafe280f71403d627ee06e107cf9ebb038cbd8e23ab100')

prepare() {
  find . -type f -exec sed -i 's/env python/env python2/' {} \;

  cd "$_pkgname-src-$pkgver/$_pkgname"
  # Fix plot library (FS#42807)
  patch -Np1 -i ../../fix-plot.patch

  sed -i "s|PyErr_Format(PyExc_RuntimeError, mesg)|return|g" \
    src/gtk/*_wrap.cpp \
    contrib/gizmos/gtk/gizmos_wrap.cpp
}

build() {
  cd "$_pkgname-src-$pkgver"

  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --includedir=/usr/include \
    --with-gtk=3 \
    --with-opengl \
    --enable-unicode \
    --enable-graphics_ctx \
    --disable-precomp-headers \
    --with-regex=sys \
    --with-libpng=sys \
    --with-libxpm=sys \
    --with-libjpeg=sys \
    --with-libtiff=sys \
    --with-wx-config=/usr/bin/wx-config-gtk3

  cd $_pkgname

  python2 setup.py WX_CONFIG=/usr/bin/wx-config-gtk3 WXPORT=gtk3 UNICODE=1 build
}

package() {
  cd "$_pkgname-src-$pkgver/$_pkgname"

  python2 setup.py WX_CONFIG=/usr/bin/wx-config-gtk3 WXPORT=gtk3 UNICODE=1 \
    install --root="$pkgdir" -O1

  for file in "$pkgdir"/usr/bin/*; do
    mv "${file}" "${file}2";
  done

  install -Dm 644 ../docs/licence.txt \
    "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

