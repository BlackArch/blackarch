# Maintainer: Hugo Doria <hugo@archlinux.org>
# Contributor: Francesco Piccinno <stack.box@gmail.com>

pkgname=wireshark-inject
_pkgname=wireshark
pkgver=1.2.3
pkgrel=1
pkgdesc="A free network protocol analyzer for Unix/Linux and Windows"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('gtk2' 'heimdal' 'libpcap' 'bash' 'gnutls' 'libcap' 'ghex' 'lorcon-old-svn' 'geoip' 'lua')
makedepends=('bison' 'flex' 'patch')
url="http://www.wireshark.org/"
replaces=('ethereal')
groups=('archpwn' 'archpwn-sniffer')
options=(!libtool)
source=(http://downloads.sourceforge.net/$_pkgname/${_pkgname}-${pkgver}.tar.gz
        lorcon-autotooling.patch
        wireshark-1.1.2--as-needed.patch
        wireshark-except-double-free.diff
        wishark.diff)
md5sums=('607eb3416e6240e4236ea5eb6eb6b6f1'
         '0884489ef0548cf00958d196844cf05f'
         'cc87d7eb31f256df751b3371b1c426e9'
         '81d414ffae4323c3d36afb14ea0377b8'
         '8ba04b4912a6231ac59e8f1a96577e7c')

build() {
  cd ${srcdir}/${_pkgname}-${pkgver}/epan
  patch -Np0 < ../../wireshark-except-double-free.diff || return 1

  cd ../
  patch -Np0 < ../lorcon-autotooling.patch || return 1
  patch -Np1 < ../wireshark-1.1.2--as-needed.patch || return 1
  patch -Np0 < ../wishark.diff || return 1

  ./autogen.sh || return 1
  ./configure --prefix=/usr/share/wireshark-inject/ --with-ssl || return 1

  make all || return 1
  make DESTDIR=${pkgdir} install || return 1
}
